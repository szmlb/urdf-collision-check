# URDF Collision Checker

## Project Overview

This project provides a command-line tool to check for collisions between two URDF (Unified Robot Description Format) objects over time. It loads two URDF models and their corresponding trajectory data from CSV files. For each synchronized timestamp across both trajectories, it updates the objects' poses in a PyBullet physics simulation and performs a collision check. The results, including collision status and closest distance at each timestamp, are saved to an output CSV file. Optional GUI visualization allows for observing the objects' motion and collision states.

## Features

*   Loads two URDF models.
*   Processes trajectories of poses for each object from user-provided CSV files.
*   Synchronizes poses based on timestamps and checks for collisions at each step.
*   Calculates and reports the minimum distance between the models at each timestamp.
*   Outputs a CSV file detailing the collision status (is_collision, closest_distance) over time.
*   Supports non-convex shapes for collision detection (via mesh geometries in URDF).
*   Optional GUI visualization of the scene, object movements, and collision checks.

## Requirements

*   Python 3.x
*   Libraries:
    *   `pybullet`
    *   `numpy`

    These can be installed by using the `requirements.txt` file.

## Setup

1.  Clone the repository (if applicable).
2.  Install the required Python libraries:
    ```bash
    pip install -r requirements.txt
    ```

## Usage

The script is run from the command line, requiring paths to two URDF files, two trajectory CSV files, and an output CSV file path.

### Syntax

```bash
python collision_checker.py <urdf_file_1> <urdf_file_2> --traj1 <path_to_traj1.csv> --traj2 <path_to_traj2.csv> --output <path_to_output.csv> [--visualize]
```

### Arguments

*   `urdf_file_1`: Path to the first URDF file.
*   `urdf_file_2`: Path to the second URDF file.
*   `--traj1 <filepath>`: Path to the CSV trajectory file for the first object. (See "Trajectory File Format" below).
*   `--traj2 <filepath>`: Path to the CSV trajectory file for the second object. (See "Trajectory File Format" below).
*   `--output <filepath>`: Path for the output CSV results file. (See "Output CSV Format" below).
*   `--visualize`: (Optional) If set, enables GUI visualization of the URDFs, their movement along trajectories, and collision checks. The PyBullet window will open and display the scene. Close the window to exit the program after visualization.

### Example

Process trajectories for a sphere and a box, visualize the interaction, and save results:
```bash
python collision_checker.py urdf_files/sphere.urdf urdf_files/box.urdf --traj1 trajectories/sphere_trajectory.csv --traj2 trajectories/box_trajectory.csv --output results.csv --visualize
```

## Trajectory File Format

Input trajectory files must be CSV files with the following header and data format:

*   **Header:** `time,x,y,z,qx,qy,qz,qw`
*   **Data Rows:**
    *   `time`: (float) Timestamp in seconds. Trajectory files are expected to be sorted by time, though the loader includes a sort step.
    *   `x,y,z`: (float) Position coordinates of the object's base link origin.
    *   `qx,qy,qz,qw`: (float) Orientation quaternion (X, Y, Z, W - scalar last) for the object's base link. PyBullet uses this order for `resetBasePositionAndOrientation`.

## Output CSV Format

The output CSV file generated by the `--output` argument will have the following format:

*   **Header:** `time,is_collision,closest_distance`
*   **Data Rows:**
    *   `time`: (float) Timestamp from the master list of unique input timestamps, representing the moment of the collision check.
    *   `is_collision`: (integer) `1` if a collision is detected at this timestamp, `0` otherwise.
    *   `closest_distance`: (float) The closest distance found between the two objects at this timestamp. Negative values indicate penetration depth. A value of `0.0` typically means the objects are touching. Positive values indicate separation.

## Running Tests

Unit tests are provided to verify the functionality of the collision checker, including pose specification and non-convex shape collisions. To run the tests:

```bash
python -m unittest discover tests
```
Alternatively, you can run the test file directly:
```bash
python tests/test_collision_checker.py
```

## Notes on URDFs and Collision Geometry

*   The collision geometry for an object is defined within its URDF file using the `<collision>` tag. This geometry is what PyBullet uses for collision detection calculations.
*   Simple primitive shapes (box, sphere, cylinder, capsule) can be directly defined within the `<geometry>` tag inside `<collision>`.
*   For non-convex shapes or more complex models, you should use a mesh file. This is specified using the `<mesh filename="path/to/your/mesh.obj"/>` element within `<collision><geometry>`. Supported mesh formats include OBJ, STL, and Collada (DAE). The provided `l_shape.urdf` and `l_shape.obj` files demonstrate this approach for a non-convex L-shape. Ensure that the mesh normals are defined correctly for accurate collision detection.

---
This README provides a comprehensive guide for users and developers of the URDF Collision Checker.
